{% extends 'FOSUserBundle::layout.html.twig' %}

{% block title %}
    {{ text.title }}
{% endblock %}

{% block body %}
    <div
            class="page-header"
    >
        <div
                class="btn-toolbar pull-right"
        >
            <div
                    class="btn-group"
            >
                <button
                        type="button"
                        class="btn btn-default"
                        data-toggle="modal"
                        data-target="#edit-text-title-modal"
                        id="js-edit-text-title-modal"
                >
                    {{ 'app.edit_title'|trans }}
                </button>
            </div>
        </div>
        <h1>
            {{ text.title }}
            <small
                    id="js-status-text-container"
            >
                All changes saved
            </small>
        </h1>
    </div>

    <div
            class="row"
    >
        <div class="
                col-xs-12
                col-md-8
                col-md-offset-2
             "
             id="js-editor"
        >
            {{ form_start(bodyForm) }}
            {{ form_widget(bodyForm) }}
            {{ form_end(bodyForm) }}
        </div>
    </div>

    {% include ':components/modal:form.html.twig' with {
        'modal_id': 'edit-text-title-modal',
        'modal_title': 'app.edit_title'|trans,
        'submit_button_value': 'app.save'|trans,
    } %}
{% endblock %}

{% block javascripts %}
    {{ parent() }}

    <script>
//        var Editor = {
//          initialize: function($wrapper) {
//            this.$wrapper = $wrapper;
//            this.$form = this.$wrapper.find('form');
//            this.$textarea = this.$form.find('textarea');
//
//            this.$textarea.on(
//              'input selectionchange propertychange',
//              this.saveDraft
//            )
//          },
//
//          saveDraft: function(event) {
//            var $form = Editor.$form;
//            var path = window.location.pathname;
//            var serializedForm = $form.serialize();
//
//            var $statusText = $('#js-status-text-container');
//
//            console.log($statusText);
//
//            $statusText.html('Saving draftâ€¦');
//
//
////            console.log(serializedForm);
//
//            $.ajax({
//              type: $form.attr('method'),
//              url: $form.attr('action'),
//              data: $form.serialize()
//            })
//              .done(function(response) {
//                $statusText.html('Draft saved');
//              });
//          }
//        };










        $(document).ready(function() {
          var $wrapper = $('#js-editor');
//          Editor.initialize($wrapper);

          var $form = $wrapper.find('form');
          var $statusText = $('#js-status-text-container');

          var timeoutId;

          $wrapper
            .find('textarea')
            .on(
              'input propertychange change selectionchange',
              function() {
                console.log('Textarea Change');

                clearTimeout(timeoutId);
                timeoutId = setTimeout(function() {


                  $.ajax({
                    type: $form.attr('method'),
                    url: $form.attr('action'),
                    data: $form.serialize()
                  })
                    .done(function(response) {
                      $statusText.html('Draft saved');
                    })
                  ;





                }, 1000);
              });


        });






























    </script>

{% endblock %}
